## Telemetry Prologue
 * Before starting your tests, go to General settings, enable "Diagnostic data" and "Enable viewing" and restart PowerToys.

## Telemetry Epilogue
 * After finishing your tests, go to General settings, press Diagnostic data viewer and check if you have xml files for the utilities you've tested and if it looks like the events in those xml files were generated by the actions you did with the utilities you've tested.

## Install tests
 * install a **previous version** on a clean machine (a clean machine doesn't have the `%localappdata%\Microsoft\PowerToys` folder)
 * open the Settings and for each module change at least one option
 * open the FancyZones editor and create two custom layouts:
    * a canvas layout with 2 zones, use unicode chars in the layout's name
    * one from grid template using 4 zones and splitting one zone
    * apply the custom canvas layout to the primary desktop
    * create a virtual desktop and apply the custom grid layout
    * if you have a second monitor apply different templates layouts for the primary desktop and for the second virtual desktop
 * install the new version (it will uninstall the old version and install the new version)
 - [X] verify the settings are preserved and FancyZones configuration is still the same
 - [X] test installing as SYSTEM (LocalSystem account)
   * Download PsTools from https://learn.microsoft.com/en-us/sysinternals/downloads/psexec
   * Run PowerToys installer with psexec tool `psexec.exe -sid <path_to_installer_exe`
   * Brief check if all modules are working

 * PER-USER and PER-MACHINE TESTS:
   * Install **previous version** on a clean machine and update with new per-machine version. Ensure that it is installed in Program files and that registry entries are under **HKLM**/Software/Classes/PowerToys. Go trhough different modules and ensure that they are working correctly.
   * Try installing per-user version over already installed per-machine version and ensure that proper error message is shown.
   * Remove PowerToys and install per-user version. Ensure that it is installed in <APPDATA>/Local/PowerToys and that registry entries are under **HKCU**/Software/Classes/PowerToys. Go trhough different modules and ensure that they are working correctly.
   * Create a new user and install per-user version there as well. Go trhough different modules and ensure that they are working correctly. Ensure that changing settings for one user does not change settings of other user.

## Functional tests

 Regressions:
 - [X] https://github.com/microsoft/PowerToys/issues/1414#issuecomment-593529038
 - [X] https://github.com/microsoft/PowerToys/issues/1524

## Localization
 Change the Windows language to a language different than English. Then verify if the following screens change their language:
 - [X] System tray menu items
   **While I see some did not finish localization, e.g. Always On Top, File Lock Smith, PowerToy Run**
 - [X] Settings
 - [ ] OOBE (What's new)
   I did not see an OOBE box
 - [X] Keyboard Manager Editor
 - [X] Color Picker (check the tooltips)
 - [X] FancyZones Editor
 - [X] Power Rename (new WinUI 3 may not be localized)
 - [X] PowerToys Run ("Start typing" string is localized, for example)
 - [X] Image Resizer
 - [X] Shortcut Guide (Windows controls are localized)
 - [X] File Explorer menu entries for Image Resizer, Power Rename and FileLocksmith
 - [X] Hosts File Editor
 - [ ] File Locksmith
      Not localized for File lock smith 
 - [ ] Registry Preview
      Not localized for Registry Preview title
 - [X] Environment Variables

## General Settings

**Admin mode:**
 - [X] restart PT and verify it runs as user
 - [X] restart as admin and set "Always run as admin"
 - [X] restart PT and verify it  runs as admin
 * if it's not on, turn on "Run at startup"
 - [X] reboot the machine and verify PT runs as admin (it should not prompt the UAC dialog)
 * turn Always run as admin" off
 - [X] reboot the machine and verify it now runs as user

**Modules on/off:**
 - [X] turn off all the modules and verify all module are off
 - [X] restart PT and verify that all module are still off in the settings page and they are actually inactive
 - [X] turn on all the module, all module are now working
 - [X] restart PT and verify that all module are still on in the settings page and they are actually working

**Quick access tray icon flyout:**
 - [X] Use left click on the system tray icon and verify the flyout appears. (It'll take a bit the first time)
 - [X] Try to launch a module from the launch screen in the flyout.
 - [X] Try disabling a module in the all apps screen in the flyout, make it a module that's launchable from the launch screen. Verify that the module is disabled and that it also disappeared from the launch screen in the flyout.
 - [X] Open the main settings screen on a module page. Verify that when you disable/enable the module on the flyout, that the Settings page is updated too.

**Settings backup/restore:**
 - [X] In the General tab, create a backup of the settings.
 - [X] Change some settings in some PowerToys.
 - [X] Restore the settings in the General tab and verify the Settings you've applied were reset.


## PowerToys Run

 * Enable PT Run in settings and ensure that the hotkey brings up PT Run
   - [X] when PowerToys is running unelevated on start-up
   - [X] when PowerToys is running as admin on start-up
   - [X] when PowerToys is restarted as admin, by clicking the restart as admin button in settings.
 * Check that each of the plugins is working:
   - [X] Program - launch a Win32 application
   - [X] Program - launch a Win32 application as admin
   - [X] Program - launch a packaged application
   - [X] Calculator - ensure a mathematical input returns a correct response and is copied on enter.
   - [X] Windows Search - open a file on the disk.
   - [X] Windows Search - find a file and copy file path.
   - [X] Windows Search - find a file and open containing folder.
   - [X] Shell - execute a command. Enter the action keyword `>`, followed by the query, both with and without space (e.g. `> ping localhost`).
   - [X] Folder - Search and open a sub-folder on entering the path.
   - [X] Uri - launch a web page on entering the uri.
   - [X] Window walker - Switch focus to a running window.
   - [X] Service - start, stop, restart windows service. Enter the action keyword `!` to get the list of services.
   - [X] Registry - navigate through the registry tree and open registry editor. Enter the action keyword `:` to get the root keys.
   - [X] Registry - navigate through the registry tree and copy key path.
   - [X] System - test `lock`.
   - [X] System - test `empty recycle bin`.
   - [X] System - test `shutdown`.

 - [X] Disable PT Run and ensure that the hotkey doesn't bring up PT Run.

 - [ ] Test tab navigation.

 * Test Plugin Manager
   - [X] Enable/disable plugins and verify changes are picked up by PT Run
   - [ ] Change `Direct activation phrase` and verify changes are picked up by PT Run
   - [ ] Change `Include in global result` and verify changes picked up by PT Run
   - [ ] Clear `Direct activation phrase` and uncheck `Include in global result`. Verify a warning message is shown.
   - [ ] Disable all plugins and verify the warning message is shown.

## Mouse Without Borders
 * Install PowerToys on two PCs in the same local network:
   - [X] Verify that PowerToys is properly installed on both PCs.
   
 * Setup Connection:
   - [X] Open MWB's settings on the first PC and click the "New Key" button. Verify that a new security key is generated.
   - [X] Copy the generated security key and paste it in the corresponding input field in the settings of MWB on the second PC. Also enter the name of the first PC in the required field.
   - [X] Press "Connect" and verify that the machine layout now includes two PC tiles, each displaying their respective PC names.
   
 * Verify Connection Status:
   - [X] Ensure that the border of the remote PC turns green, indicating a successful connection.
   - [-] Enter an incorrect security key and verify that the border of the remote PC turns red, indicating a failed connection.
   	Actually border is yellow, never turns into green after click connect if key is not correct.

 * Test Remote Mouse/Keyboard Control:
   - [X] With the PCs connected, test the mouse/keyboard control from one PC to another. Verify that the mouse/keyboard inputs are correctly registered on the other PC.
   - [X] Test remote mouse/keyboard control across all four PCs, if available. Verify that inputs are correctly registered on each connected PC when the mouse is active there.
   
 * Test Remote Control with Elevated Apps:
   - [X] Open an elevated app on one of the PCs. Verify that without "Use Service" enabled, PowerToys does not control the elevated app.
   - [X] Enable "Use Service" in MWB's settings. Verify that PowerToys can now control the elevated app remotely. Verify that MWB processes are running as LocalSystem, while the MWB helper process is running non-elevated.
   - [X] Toggle "Use Service" again, verify that each time you do that, the MWB processes are restarted.
	--Yes, but lose control for a while
   - [X] Run PowerToys elevated on one of the machines, verify that you can control elevated apps remotely now on that machine.

* Test Module Enable Status:
   - [X] For all combinations of "Use Service"/"Run PowerToys as admin", try enabling/disabling MWB module and verify that it's indeed being toggled using task manager.
   
 * Test Disconnection/Reconnection:
   - [X] Disconnect one of the PCs from network. Verify that the machine layout updates to reflect the disconnection. 
	COMMENT: Actually, no layout change, only border change
   - [X] Do the same, but now by exiting PowerToys.
   - [X] Start PowerToys again, verify that the PCs are reconnected.
  
 * Test Various Local Network Conditions:
   - [X] Test MWB performance under various network conditions (e.g., low bandwidth, high latency). Verify that the tool maintains a stable connection and functions correctly.

 * Clipboard Sharing:
   - [X] Copy some text on one PC and verify that the same text can be pasted on another PC.
   - [X] Use the screenshot key and Win+Shift+S to take a screenshot on one PC and verify that the screenshot can be pasted on another PC.
   - [X] Copy a file in Windows Explorer and verify that the file can be pasted on another PC. Make sure the file size is below 100MB.
   - [X] Try to copy multiple files and directories and verify that it's not possible (only the first selected file is being copied).
 
 * Drag and Drop:
   - [X] Drag a file from Windows Explorer on one PC, cross the screen border onto another PC, and release it there. Verify that the file is copied to the other PC. Make sure the file size is below 100MB.
   - [-] While dragging the file, verify that a corresponding icon is displayed under the mouse cursor.
	NO, really unstable
   - [X] Without moving the mouse from one PC to the target PC, press CTRL+ALT+F1/2/3/4 hotkey to switch to the target PC directly and verify that file sharing/dropping is not working.

 * Lock and Unlock with "Use Service" Enabled:
   - [X] Enable "Use Service" in MWB's settings.
   - [X] Lock a remote PC using Win+L, move the mouse to it remotely, and try to unlock it. Verify that you can unlock the remote PC.
   - [X] Disable "Use Service" in MWB's settings, lock the remote PC, move the mouse to it remotely, and try to unlock it. Verify that you can't unlock the remote PC.

 * Test Settings:
   - [-] Change the rest of available settings on MWB page and verify that each setting works as described.
	When I toggle on the wrap mouse, I can't go to the controller machine any more. - One time, but I can't reproduce


## DSC
 * You need to have some prerequisites installed:
   - PowerShell >= 7.2 .
   - PSDesiredStateConfiguration 2.0.7 or higher `Install-Module -Name PSDesiredStateConfiguration`.
   - WinGet [version v1.6.2631 or later](https://github.com/microsoft/winget-cli/releases). (You'll likely have this one already)
 * Open a PowerShell 7 instance and navigate to the sample scripts from PowerToys (`src/dsc/Microsoft.PowerToys.Configure/examples/`).
   - [X] Run `winget configure .\disableAllModules.dsc.yaml`. Open PowerToys Settings and verify all modules are disabled.
   - [X] Run `winget configure .\enableAllModules.dsc.yaml`. Open PowerToys Settings and verify all modules are enabled.
   - [X] Run `winget configure .\configureLauncherPlugins.dsc.yaml`. Open PowerToys Settings and verify all PowerToys Run plugins are enabled, and the Program plugin is not global and its Activation Keyword has changed to "P:".
   - [X] Run `winget configure .\configuration.dsc.yaml`. Open PowerToys Settings the Settings have been applied. File Locksmith is disabled. Shortcut Guide is disabled with an overlay opacity set to 50. FancyZones is enabled with the Editor hotkey set to "Shift+Ctrl+Alt+F".
   - [X] If you run a winget configure command above and PowerToys is running, it will eventually close and automatically reopen after the configuration process is done.
   - [X] If you run a winget configure command above and PowerToys is not running, it won't automatically reopen after the configuration process is done.

## Workspaces
* Settings
   - [X] Launch the Editor by clicking the button on the settings page.
   - [X] Launch the Editor from quick access.
   - [X] Launch the Editor by the Activation shortcut.
   - [X] Disable the module and and verify it won't launch by the shortcut.

* Snapshot tool: try with elevated and non-elevated PT
   * Open non-packaged apps, e.g., VisualStudio, VisualStudioCode.
   * Open packaged apps, e.g., Notepad, Settings.
   * Run any app as an administrator.
   * Minimize any app.
   * Click `Create Workspace`.
   * Open any other window.
   * Click `Capture`
   - [X] Verify Editor shows all opened windows (the elevated window will be captured if PT is also elevated)
   - [X] Verify windows are in the correct positions.
   - [X] Verify elevated app has the `Admin` box checked (if captured).

* Editor
   - [X] Verify that the new Workspace appears in the list after capturing.
   - [X] Verify that the new Workspace doesn't appear after canceling the Capture.
   - [X] Verify `Search` filters Workspaces (by workspace name or app name).
   - [X] Verify `SortBy` works.
   - [X] Verify `SortBy` keeps its value when you close and open the editor again.
   - [X] Verify `Remove` removes the Workspace from the list.
   - [X] Verify `Edit` opens the Workspace editing page.
   - [X] Verify clicking at the Workspace opens the Workspace editing page.
   
   * Editing page
   - [X] `Remove` an app and verify it disappeared on the preview.
   - [X] `Remove` and `Add back` an app, verify it's returned back to the preview.
   - [X] Set an app minimized, check the preview.
   - [X] Set an app maximized, check the preview.
   - [X] Check `Launch as admin` for the app where it's available.
   - [X] Add CLI args, e.g. path to the PowerToys.sln file for VisualStudio.
   - [X] Manually change the position for the app, check the preview.
   - [X] Change the Workspace name.
   - [X] Verify `Save` and `Cancel` work as expected. 
   - [X] Change anything in the project, click at the `Workspaces` on the top of the page, and verify you returned to the main page without saving any changes.
   - [X] Check `Create desktop shortcut`, save the project, verify the shortcut appears on the desktop. 
   - [X] Verify that `Create desktop shortcut` is checked when the shortcut is on the desktop and unchecked when there is no shortcut on the desktop. 
   - [X] Click `Launch and Edit`, wait for the apps to launch, click `Capture`, verify opened apps are added to the project.

* Launcher
   - [X] Click `Launch` in the editor, verify the Workspace apps launching.
   - [X] Launch Workspace by a shortcut, verify the Workspace apps launching.
   - [X] Verify a window with launching progress is shown while apps are launching and presents the correct launching state (launching, launched, not launched) for every app.
   - [X] Click `Cancel launch`, verify launching is stopped at the current state (opened apps will stay opened), and the window is closed.
   - [X] Click `Dismiss` and verify apps keep launching, but the LauncherUI window is closed.
   
* To verify that the launcher works correctly with different apps, try to capture and launch:   
   - [X] Non-packaged app, e.g., VisualStudio code
      - [X] As admin
      - [X] With CLI args 
    - [X] Packaged app, e.g. Terminal
      - [X] As admin
      - [X] With CLI args

* Try to launch the Workspace with a different setup
   - [X] Create a Workspace with one monitor connected, connect the second monitor, launch the Workspace, verify apps are opened on the first one, as captured.
   - [X] Create a Workspace with two monitors connected, disconnect a monitor, verify apps are opened on the remaining one.
